<!doctype html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Diagnostic Life Skills - Mission Locale</title>
<script src="/_sdk/data_sdk.js"></script>
<script src="/_sdk/element_sdk.js"></script>

<style>
:root {
--ml-orange: #f39200;
--ml-green: #95c11f;
--ml-blue: #2897d5;
--ml-pink: #d60b52;
--ml-violet: #a3195b;
--ml-brick: #9f3d3f;
--ml-black: #171718;

--ls-red: #e53935;
--ls-yellow: #ffca28;
--ls-turquoise: #26c6da;
--ls-mint: #a5d6a7;

--bg-page: #f5f5f7;
--bg-card: #ffffff;
--border-soft: #e2e8f0;
--text-main: #1f2933;
--text-muted: #6b7280;
--radius-lg: 18px;
--radius-md: 12px;
--shadow-soft: 0 10px 30px rgba(15, 23, 42, 0.08);
}

* {
box-sizing: border-box;
}

body {
margin: 0;
padding: 20px;
font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI",
"Roboto", sans-serif;
background: var(--bg-page);
color: var(--text-main);
}

.container {
max-width: 1050px;
margin: 0 auto;
background: var(--bg-card);
border-radius: 24px;
box-shadow: var(--shadow-soft);
overflow: hidden;
border: 1px solid var(--border-soft);
}

/* HEADER / BRANDING */

.header {
position: relative;
padding: 28px 32px 26px;
background: linear-gradient(135deg, #ffffff 0%, #fdf6ee 40%, #f3fbff 100%);
border-bottom: 3px solid var(--ml-orange);
display: flex;
flex-direction: column;
gap: 16px;
}

.header-top {
display: flex;
justify-content: space-between;
align-items: center;
gap: 16px;
flex-wrap: wrap;
}

.logo-left,
.logo-container {
background: #ffffff;
border-radius: 999px;
padding: 6px 14px;
display: inline-flex;
align-items: center;
justify-content: center;
box-shadow: 0 4px 14px rgba(15, 23, 42, 0.06);
border: 1px solid #edf2f7;
max-height: 56px;
}

.logo-left img,
.logo-container img {
max-height: 42px;
width: auto;
object-fit: contain;
}

.header-text {
display: flex;
flex-direction: column;
gap: 4px;
}

.header h1 {
margin: 0;
font-size: 1.85rem;
font-weight: 800;
color: var(--ml-black);
letter-spacing: 0.03em;
}

.header-subtitle {
font-size: 0.95rem;
color: var(--text-muted);
}

.header-tags {
display: flex;
flex-wrap: wrap;
gap: 8px;
margin-top: 8px;
}

.tag {
font-size: 0.75rem;
text-transform: uppercase;
letter-spacing: 0.06em;
padding: 4px 10px;
border-radius: 999px;
background: #fff7e6;
color: var(--ml-orange);
border: 1px solid #ffe0b2;
font-weight: 600;
}

.tag-secondary {
background: #e3f2fd;
color: var(--ml-blue);
border-color: #bbdefb;
}

.tag-life {
background: #fce4ec;
color: var(--ml-pink);
border-color: #f8bbd0;
}

/* CONTENT LAYOUT */

.content {
padding: 28px 28px 30px;
background: #ffffff;
}

.step {
display: none;
}

.step.active {
display: block;
}

.intro-section {
margin-bottom: 24px;
text-align: left;
}

.intro-section h2 {
margin: 0 0 10px;
font-size: 1.4rem;
font-weight: 800;
color: var(--ml-black);
display: flex;
align-items: center;
gap: 8px;
}

.intro-section h2 span {
font-size: 1.5rem;
}

.intro-section p {
margin: 0;
color: var(--text-muted);
font-size: 0.95rem;
line-height: 1.5;
}

.how-it-works {
margin-top: 20px;
border-radius: var(--radius-lg);
padding: 18px 18px 14px;
border: 1px solid #e0f2ff;
background: linear-gradient(
135deg,
#f3f8ff 0%,
#ffffff 55%,
#fff8f1 100%
);
}

.how-it-works h3 {
margin: 0 0 8px;
font-size: 0.95rem;
text-transform: uppercase;
letter-spacing: 0.08em;
color: var(--ml-blue);
font-weight: 700;
}

.how-it-works p {
margin: 0 0 10px;
font-size: 0.9rem;
color: var(--text-main);
}

.scale-legend {
display: grid;
grid-template-columns: repeat(4, minmax(0, 1fr));
gap: 8px;
margin-top: 10px;
}

.scale-item {
border-radius: var(--radius-md);
padding: 8px;
text-align: center;
font-size: 0.8rem;
color: #ffffff;
font-weight: 500;
}

.scale-item small {
display: block;
margin-top: 2px;
font-size: 0.7rem;
opacity: 0.9;
}

.scale-1 {
background: var(--ls-red);
}

.scale-2 {
background: var(--ls-yellow);
color: #4e342e;
}

.scale-3 {
background: var(--ls-turquoise);
}

.scale-4 {
background: var(--ls-mint);
color: #1b5e20;
}

.form-group {
margin-bottom: 18px;
}

.form-group label {
display: block;
margin-bottom: 6px;
font-size: 0.9rem;
font-weight: 600;
color: var(--text-main);
}

.required {
color: var(--ml-pink);
margin-left: 2px;
}

.form-group input {
width: 100%;
border-radius: 999px;
border: 1px solid var(--border-soft);
padding: 10px 14px;
font-size: 0.95rem;
outline: none;
transition: border-color 0.2s, box-shadow 0.2s;
}

.form-group input:focus {
border-color: var(--ml-blue);
box-shadow: 0 0 0 3px rgba(40, 151, 213, 0.15);
}

/* SAVED / LOCAL DATA */

.saved-assessments {
margin: 18px 0;
border-radius: var(--radius-lg);
border: 1px solid #e5e7eb;
background: #f9fafb;
padding: 12px 14px;
}

.saved-assessments h3 {
margin: 0 0 10px;
font-size: 0.9rem;
color: var(--text-main);
}

.assessment-item {
background: #ffffff;
border-radius: var(--radius-md);
padding: 10px 12px;
display: flex;
align-items: center;
justify-content: space-between;
gap: 10px;
border: 1px solid #edf2f7;
margin-bottom: 8px;
font-size: 0.85rem;
}

.assessment-info {
display: flex;
flex-direction: column;
gap: 2px;
}

.assessment-name {
font-weight: 600;
color: var(--text-main);
}

.assessment-date {
color: var(--text-muted);
font-size: 0.8rem;
}

.local-load {
margin-top: 8px;
font-size: 0.8rem;
color: var(--text-muted);
}

/* DOMAINS / QUESTIONS */

.progress-bar {
width: 100%;
height: 8px;
background: #f3f4f6;
border-radius: 999px;
overflow: hidden;
margin-bottom: 18px;
}

.progress-fill {
height: 100%;
width: 0;
border-radius: 999px;
background: linear-gradient(
90deg,
var(--ml-orange),
var(--ml-pink),
var(--ml-blue)
);
transition: width 0.4s ease;
}

.domain-section {
border-radius: var(--radius-lg);
border: 1px solid var(--border-soft);
padding: 20px 18px 18px;
margin-bottom: 18px;
background: #ffffff;
}

.domain-title {
display: flex;
align-items: center;
gap: 10px;
margin-bottom: 6px;
font-size: 1.1rem;
font-weight: 700;
color: var(--ml-black);
}

.domain-icon {
font-size: 1.4rem;
}

.domain-objective {
font-size: 0.9rem;
color: var(--text-muted);
margin-bottom: 12px;
}

.domain-objective strong {
color: var(--ml-blue);
font-weight: 600;
}

.question {
margin-bottom: 14px;
padding: 10px 10px 4px;
border-radius: var(--radius-md);
}

.question:nth-child(odd) {
background: #f9fafb;
}

.question-text {
font-size: 0.95rem;
margin-bottom: 8px;
color: var(--text-main);
}

.rating-scale {
display: grid;
grid-template-columns: repeat(4, minmax(0, 1fr));
gap: 8px;
}

.rating-option {
position: relative;
display: flex;
align-items: center;
justify-content: center;
gap: 4px;
padding: 8px 6px;
border-radius: 999px;
border: 1px solid transparent;
background: #ffffff;
cursor: pointer;
font-size: 0.8rem;
color: var(--text-main);
transition: background-color 0.15s, border-color 0.15s, transform 0.1s;
}

.rating-option input[type="radio"] {
display: none;
}

.rating-label {
display: inline-flex;
align-items: center;
gap: 4px;
white-space: nowrap;
}

.rating-option[data-value="1"] {
border-color: #ffcdd2;
background: #ffebee;
}

.rating-option[data-value="2"] {
border-color: #ffe0b2;
background: #fff8e1;
}

.rating-option[data-value="3"] {
border-color: #b2ebf2;
background: #e0f7fa;
}

.rating-option[data-value="4"] {
border-color: #c8e6c9;
background: #e8f5e9;
}

.rating-option.selected {
transform: translateY(-1px);
box-shadow: 0 2px 8px rgba(15, 23, 42, 0.12);
font-weight: 600;
}

.rating-option[data-value="1"].selected {
border-color: var(--ls-red);
}

.rating-option[data-value="2"].selected {
border-color: var(--ls-yellow);
}

.rating-option[data-value="3"].selected {
border-color: var(--ls-turquoise);
}

.rating-option[data-value="4"].selected {
border-color: var(--ls-mint);
}

/* BUTTONS */

.btn-row {
text-align: center;
margin-top: 20px;
display: flex;
flex-wrap: wrap;
gap: 10px;
justify-content: center;
}

.btn {
border-radius: 999px;
border: none;
padding: 10px 20px;
font-size: 0.9rem;
font-weight: 600;
cursor: pointer;
display: inline-flex;
align-items: center;
gap: 6px;
transition: background-color 0.15s, box-shadow 0.15s, transform 0.1s;
white-space: nowrap;
}

.btn-primary {
background: var(--ml-orange);
color: #ffffff;
box-shadow: 0 4px 14px rgba(243, 146, 0, 0.35);
}

.btn-primary:hover:not(:disabled) {
background: #e28500;
transform: translateY(-1px);
}

.btn-secondary {
background: #e3f2fd;
color: var(--ml-blue);
border: 1px solid #bbdefb;
box-shadow: none;
}

.btn-secondary:hover:not(:disabled) {
background: #d2e8fb;
transform: translateY(-1px);
}

.btn-outline {
background: #ffffff;
color: var(--text-main);
border: 1px solid #d1d5db;
}

.btn-outline:hover:not(:disabled) {
background: #f9fafb;
transform: translateY(-1px);
}

.btn-small {
padding: 6px 12px;
font-size: 0.8rem;
box-shadow: none;
}

.btn:disabled {
opacity: 0.6;
cursor: not-allowed;
box-shadow: none;
transform: none;
}

/* RESULTS */

.results-section h2 {
font-size: 1.35rem;
margin: 0 0 10px;
font-weight: 800;
color: var(--ml-black);
}

.results-section p {
margin: 0 0 10px;
font-size: 0.95rem;
color: var(--text-muted);
}

.radar-container {
display: flex;
flex-wrap: wrap;
gap: 16px;
margin: 20px 0;
}

.chart-container {
flex: 1 1 260px;
border-radius: var(--radius-lg);
border: 1px solid var(--border-soft);
padding: 14px 16px;
background: #f9fafb;
}

.chart-title {
font-size: 0.95rem;
font-weight: 700;
color: var(--ml-black);
margin-bottom: 10px;
display: flex;
align-items: center;
gap: 6px;
}

.life-skills-grid {
display: grid;
grid-template-columns: repeat(2, minmax(0, 1fr));
gap: 10px;
}

.skill-card {
background: #ffffff;
border-radius: var(--radius-md);
padding: 10px 12px;
border: 1px solid #e5e7eb;
display: flex;
align-items: center;
justify-content: space-between;
gap: 6px;
}

.skill-name {
font-size: 0.85rem;
color: var(--text-main);
font-weight: 600;
}

.skill-score {
font-size: 1rem;
font-weight: 700;
color: var(--ml-pink);
}

.domain-bars {
display: grid;
grid-template-columns: repeat(2, minmax(0, 1fr));
gap: 8px;
}

.domain-bar {
border-radius: var(--radius-md);
background: #ffffff;
border: 1px solid #e5e7eb;
padding: 8px 8px 6px;
}

.domain-bar-name {
font-size: 0.8rem;
font-weight: 600;
color: var(--text-main);
margin-bottom: 4px;
}

.bar-container {
width: 100%;
height: 18px;
border-radius: 999px;
background: #f3f4f6;
overflow: hidden;
}

.bar-fill {
height: 100%;
border-radius: 999px;
background: linear-gradient(
90deg,
var(--ml-green),
var(--ml-blue),
var(--ml-pink)
);
font-size: 0.75rem;
color: #ffffff;
display: flex;
align-items: center;
justify-content: center;
white-space: nowrap;
transition: width 0.5s ease;
}

.priority-areas,
.action-plan {
border-radius: var(--radius-lg);
border: 1px solid #e5e7eb;
padding: 16px 16px 12px;
background: #fdfdfd;
margin-top: 16px;
}

.priority-title,
.action-title {
font-size: 1rem;
font-weight: 700;
margin: 0 0 8px;
color: var(--ml-black);
}

.priority-areas p,
.action-plan p {
font-size: 0.9rem;
margin-bottom: 6px;
}

.priority-areas label {
display: block;
font-size: 0.85rem;
background: #ffffff;
border: 1px solid #e5e7eb;
border-radius: var(--radius-md);
padding: 8px 10px;
margin-bottom: 6px;
cursor: pointer;
}

#selectedPriorities {
font-size: 0.85rem;
color: var(--ml-blue);
}

/* ACTIVITIES */

.activity-card {
border-radius: var(--radius-lg);
border: 1px solid #e5e7eb;
padding: 14px 14px 10px;
background: #ffffff;
margin-bottom: 12px;
box-shadow: 0 4px 10px rgba(15, 23, 42, 0.03);
}

.activity-header {
display: flex;
align-items: center;
gap: 10px;
margin-bottom: 8px;
}

.activity-icon {
font-size: 1.4rem;
}

.activity-title {
margin: 0;
font-size: 0.98rem;
font-weight: 700;
color: var(--text-main);
}

.activity-subtitle {
margin: 0;
font-size: 0.8rem;
color: var(--text-muted);
}

.activity-card p {
font-size: 0.9rem;
margin-bottom: 6px;
}

.skills-tags {
display: flex;
flex-wrap: wrap;
gap: 6px;
margin: 8px 0;
}

.skill-tag {
font-size: 0.75rem;
border-radius: 999px;
padding: 4px 8px;
background: #f3e5f5;
color: var(--ml-violet);
}

.activity-meta {
display: flex;
flex-wrap: wrap;
gap: 6px;
margin-bottom: 8px;
}

.meta-item {
font-size: 0.75rem;
padding: 4px 8px;
border-radius: 999px;
background: #f3f4f6;
color: var(--text-muted);
}

.activity-steps h4 {
font-size: 0.9rem;
margin: 6px 0;
}

.step-list {
list-style: none;
padding: 0;
margin: 0;
}

.step-item {
font-size: 0.85rem;
padding: 5px 6px;
border-left: 3px solid var(--ml-green);
background: #f9fafb;
border-radius: 4px;
margin-bottom: 4px;
}

.transfer-note {
margin-top: 6px;
font-size: 0.85rem;
background: #e3f2fd;
border-radius: var(--radius-md);
padding: 8px 10px;
border: 1px solid #bbdefb;
}

.transfer-title {
font-weight: 600;
color: var(--ml-blue);
margin-bottom: 2px;
font-size: 0.85rem;
}

/* INLINE MESSAGES */

.inline-message {
position: fixed;
right: 20px;
top: 20px;
background: var(--ml-blue);
color: #ffffff;
padding: 10px 14px;
border-radius: 999px;
box-shadow: 0 10px 30px rgba(15, 23, 42, 0.25);
font-size: 0.85rem;
font-weight: 500;
display: flex;
align-items: center;
gap: 8px;
z-index: 9999;
}

.inline-message.error {
background: #e53935;
}

.inline-message.warning {
background: #fb8c00;
}

.inline-message.success {
background: var(--ml-green);
color: #12351b;
}

.inline-message span {
font-size: 1rem;
}

/* LOADING */

.loading {
display: none;
text-align: center;
margin-top: 10px;
font-size: 0.9rem;
color: var(--text-muted);
}

.spinner {
width: 24px;
height: 24px;
border-radius: 999px;
border: 3px solid #e5e7eb;
border-top-color: var(--ml-blue);
margin: 0 auto 6px;
animation: spin 0.8s linear infinite;
}

@keyframes spin {
to {
transform: rotate(360deg);
}
}

/* RESPONSIVE */

@media (max-width: 768px) {
body {
padding: 8px;
}

.container {
border-radius: 18px;
}

.header {
padding: 18px 16px 16px;
}

.header h1 {
font-size: 1.35rem;
}

.content {
padding: 18px 14px 20px;
}

.scale-legend {
grid-template-columns: repeat(2, minmax(0, 1fr));
}

.rating-scale {
grid-template-columns: repeat(2, minmax(0, 1fr));
}

.life-skills-grid {
grid-template-columns: repeat(1, minmax(0, 1fr));
}

.domain-bars {
grid-template-columns: repeat(1, minmax(0, 1fr));
}

.radar-container {
flex-direction: column;
}

.btn-row {
flex-direction: column;
}

.inline-message {
left: 8px;
right: 8px;
top: 10px;
justify-content: center;
}
}

/* PRINT (EXPORT PDF) */

@media print {
body {
padding: 0;
background: #ffffff;
}

.container {
box-shadow: none;
border-radius: 0;
border: none;
}

.btn,
.inline-message,
.loading {
display: none !important;
}

.header {
border-bottom: 2px solid var(--ml-orange);
}
}
</style>
<style>@view-transition { navigation: auto; }</style>
<script src="https://cdn.tailwindcss.com" type="text/javascript"></script>
</head>
<body>
<div class="container" aria-label="Diagnostic Life Skills Mission Locale">
<div class="header">
<div class="header-top">
<div class="logo-left">
<img src="https://static.wixstatic.com/media/dd5dab_47743b1c86024865ba19e623a3db327f~mv2.avif/v1/fill/w_313,h_84,al_c,lg_1,q_80,enc_avif,quality_auto/dd5dab_47743b1c86024865ba19e623a3db327f~mv2.avif"
alt="Mission Locale Pays Basque"
onerror="this.src=''; this.alt='Logo Mission Locale'; this.style.display='none';">
</div>
<div class="header-text">
<h1 id="toolTitle">Diagnostic Life Skills</h1>
<div class="header-subtitle" id="organizationName">
Mission Locale Pays Basque ‚Äì Rep√©rage & Premier Entretien
</div>
<div class="header-tags" aria-hidden="true">
<span class="tag">Life Skills</span>
<span class="tag tag-secondary">Parcours d'insertion</span>
<span class="tag tag-life">Jeunes 16‚Äì25 ans</span>
</div>
</div>
<div class="logo-container">
<img src="https://static.wixstatic.com/media/dd5dab_31e98305be67485d92cdb56f82c0e03f~mv2.png/v1/fill/w_560,h_224,al_c,q_85,usm_0.66_1.00_0.01,enc_avif,quality_auto/LS4YOU_Logo.png"
alt="LS4YOU ‚Äì Life Skills for Youth"
onerror="this.src=''; this.alt='Logo LS4YOU'; this.style.display='none';">
</div>
</div>
</div>

<div class="content">
<!-- √âtape 1: Accueil -->
<div class="step active" id="step-welcome" aria-labelledby="welcome-title">
<div class="intro-section">
<h2 id="welcome-title"><span>üéØ</span> Ton diagnostic Life Skills</h2>
<p id="instructionsText">
Ce diagnostic rep√®re tes forces et ce qui peut √™tre travaill√© dans 11 domaines du quotidien
(emploi, formation, sant√©, logement, budget, mobilit√©, etc.). Il sert de support √† l‚Äô√©change
avec ton conseiller.
</p>

<div class="how-it-works" aria-label="Comment r√©pondre aux questions">
<h3>Comment r√©pondre ?</h3>
<p>Pour chaque phrase, choisis ce qui te ressemble le plus en ce moment :</p>
<div class="scale-legend">
<div class="scale-item scale-1">
üôà Pas encore
<small>Ce n‚Äôest pas moi / tr√®s rare</small>
</div>
<div class="scale-item scale-2">
üôÇ Un peu
<small>√áa m‚Äôarrive, pas tout le temps</small>
</div>
<div class="scale-item scale-3">
üí™ Plut√¥t oui
<small>Assez souvent, je me reconnais dedans</small>
</div>
<div class="scale-item scale-4">
üåü Tout √† fait
<small>C‚Äôest vraiment moi / tr√®s souvent</small>
</div>
</div>
</div>
</div>

<div class="form-group">
<label for="participantName">Ton pr√©nom et nom<span class="required">*</span></label>
<input type="text" id="participantName" placeholder="Ex : Lina Martin" required
aria-required="true">
</div>

<div class="saved-assessments" id="savedAssessments" style="display: none;">
<h3>Diagnostics d√©j√† enregistr√©s</h3>
<div id="assessmentsList"></div>
</div>

<div class="local-load">
<button class="btn btn-small btn-outline" type="button"
onclick="loadLocalAssessment()" aria-label="Charger le dernier diagnostic enregistr√© sur cet appareil">
üîÅ Charger le dernier diagnostic sur cet appareil
</button>
</div>

<div class="btn-row">
<button class="btn btn-primary" onclick="startAssessment()" aria-label="Commencer le diagnostic">
‚ñ∂Ô∏è Commencer le diagnostic
</button>
<button class="btn btn-secondary" type="button" onclick="exportToPDF()" aria-label="Exporter en PDF">
üßæ Exporter en PDF
</button>
</div>
</div>

<!-- √âtape 2: Questions -->
<div class="step" id="step-assessment" aria-label="Questions par domaine">
<div class="progress-bar" aria-hidden="true">
<div class="progress-fill" id="progressFill"></div>
</div>
<div id="questionsContainer"></div>
<div class="btn-row" aria-label="Navigation entre les domaines">
<button class="btn btn-secondary" id="prevBtn" onclick="previousDomain()" style="display:none;"
aria-label="Revenir au domaine pr√©c√©dent">
‚óÄÔ∏è Pr√©c√©dent
</button>
<button class="btn btn-primary" id="nextBtn" onclick="nextDomain()"
aria-label="Passer au domaine suivant">
Suivant ‚ñ∂Ô∏è
</button>
</div>
</div>

<!-- √âtape 3: R√©sultats -->
<div class="step" id="step-results" aria-label="R√©sultats du diagnostic">
<div class="results-section">
<h2>üìä Tes r√©sultats Life Skills</h2>
<p>
Ces r√©sultats servent de base au dialogue avec ton conseiller. Ensemble, vous choisirez
les domaines √† travailler en priorit√© et les activit√©s adapt√©es.
</p>

<div class="radar-container">
<div class="chart-container" aria-label="Synth√®se par grands axes Life Skills">
<div class="chart-title">üß† Axes Life Skills</div>
<div class="life-skills-grid" id="lifeSkillsResults"></div>
</div>
<div class="chart-container" aria-label="R√©sultats par domaine de vie">
<div class="chart-title">üìà Domaines de ton quotidien</div>
<div class="domain-bars" id="domainResults"></div>
</div>
</div>

<div class="priority-areas" id="priorityAreas"></div>

<div class="action-plan">
<div class="action-title">üí¨ Pour en parler avec ton conseiller</div>
<div id="debriefQuestions">
<p><strong>Ce que tu fais d√©j√† bien :</strong></p>
<p><em>Dans quels domaines te sens-tu le plus √† l‚Äôaise ? Qu‚Äôest-ce que tu veux garder / renforcer ?</em></p>
<p><strong>Ce qui freine un peu :</strong></p>
<p><em>O√π est-ce que c‚Äôest le plus compliqu√© en ce moment ? Qu‚Äôest-ce qui te bloque ?</em></p>
<p><strong>Ce qui pourrait t‚Äôaider maintenant :</strong></p>
<p><em>De quelles aides, activit√©s ou coups de pouce tu aurais besoin pour avancer ?</em></p>
</div>
</div>

<div class="action-plan" id="actionPlan"></div>

<div class="btn-row">
<button class="btn btn-secondary" onclick="restartAssessment()">
üîÅ Nouveau diagnostic
</button>
<button class="btn btn-primary" id="saveBtn" onclick="saveResults()">
üíæ Sauvegarder
</button>
<button class="btn btn-outline" onclick="showActivities()">
üéØ Voir les activit√©s propos√©es
</button>
<button class="btn btn-secondary" type="button" onclick="exportToPDF()">
üßæ Exporter en PDF
</button>
</div>
</div>
</div>

<!-- √âtape 4: Activit√©s -->
<div class="step" id="step-activities" aria-label="Activit√©s propos√©es">
<div class="results-section">
<h2>üéØ Activit√©s LS4YOU adapt√©es √† ton profil</h2>
<p>
Ces activit√©s permettent de travailler concr√®tement certaines comp√©tences (Life Skills)
li√©es √† tes domaines prioritaires.
</p>
<div id="activitiesContainer"></div>
<div class="btn-row">
<button class="btn btn-secondary" onclick="showStep('step-results')">
‚óÄÔ∏è Retour aux r√©sultats
</button>
<button class="btn btn-outline" onclick="restartAssessment()">
üîÅ Refaire un diagnostic
</button>
</div>
</div>
</div>

<div class="loading" id="loading">
<div class="spinner" aria-hidden="true"></div>
<p>Sauvegarde en cours‚Ä¶</p>
</div>
</div>
</div>

<script>
// --- CONFIG DOMAINS (questions reformul√©es, plus jeunes & neutres) ---

const domains = [
{
name: "Emploi",
icon: "üíº",
objective: "Voir comment tu te pr√©sentes, comprends les attentes d‚Äôun job et demandes de l‚Äôaide quand il faut.",
questions: [
"Je sais mettre en avant mes qualit√©s quand je parle de moi.",
"Quand je dois me pr√©senter pour un job, j‚Äôarrive √† dire pourquoi on peut compter sur moi.",
"Quand on me confie quelque chose, je comprends globalement ce qu‚Äôon attend de moi.",
"Si je ne suis pas s√ªr de ce qu‚Äôil faut faire, je peux demander des explications.",
"J‚Äôai d√©j√† rep√©r√© au moins un type de job dans lequel je me verrais bien."
],
lifeSkills: {
"Personnalit√©": "motivation / choix / forces",
"Valorisation": "parler de soi / pitch",
"Bien-√™tre": "stress entretien, pression",
"Ressources": "salaire / contrats"
}
},
{
name: "Formation",
icon: "üìö",
objective: "Observer ta fa√ßon d‚Äôapprendre, de rester jusqu‚Äôau bout et de g√©rer les √©valuations.",
questions: [
"Quand quelque chose m‚Äôint√©resse, je peux rester concentr√© un moment dessus.",
"Si je commence une formation ou un atelier, j‚Äôessaie d‚Äôaller au bout.",
"En cours ou en atelier, je peux dire quand je n‚Äôai pas compris.",
"Les contr√¥les ou √©valuations peuvent me stresser, mais je r√©ussis √† les passer.",
"Si une formation peut m‚Äôaider pour la suite, je suis pr√™t¬∑e √† m‚Äôy investir."
],
lifeSkills: {
"Personnalit√©": "pers√©v√©rance / rapport √† l'effort",
"Valorisation": "reconnaissance des progr√®s",
"Bien-√™tre": "charge mentale / stress scolaire",
"Ressources": "aides formation"
}
},
{
name: "Orientation",
icon: "üß≠",
objective: "Rep√©rer ce que tu aimes, tes id√©es pour la suite et ta souplesse si √ßa change.",
questions: [
"J‚Äôai au moins une id√©e de ce que j‚Äôaimerais faire plus tard (m√™me si ce n‚Äôest pas pr√©cis).",
"Je sais dire ce que j‚Äôaime bien faire et ce qui m‚Äôennuie.",
"Je vois des liens entre ce que je fais aujourd‚Äôhui (loisirs, stages, exp√©riences) et des id√©es de m√©tiers.",
"Je sais que j‚Äôai le droit de tester, d‚Äôessayer, et de changer d‚Äôavis.",
"M√™me si tout n‚Äôest pas clair, je vois quelques pistes possibles pour la suite."
],
lifeSkills: {
"Personnalit√©": "int√©r√™ts / valeurs",
"Valorisation": "confiance / identit√©",
"Bien-√™tre": "anxi√©t√© orientation",
"Ressources": "r√©alit√©s m√©tiers / contraintes"
}
},
{
name: "Mobilit√©",
icon: "üöó",
objective: "Comprendre comment tu t‚Äôorganises pour te d√©placer et g√©rer les trajets.",
questions: [
"Quand j‚Äôai un rendez-vous important, je peux m‚Äôy rendre (m√™me si ce n‚Äôest pas simple).",
"J‚Äôai au moins un moyen de me d√©placer (bus, voiture, v√©lo, marche, covoiturage‚Ä¶).",
"Si je dois aller dans un endroit que je ne connais pas, je peux me renseigner pour y aller.",
"Les transports (co√ªt, horaires, organisation) peuvent √™tre compliqu√©s, mais je cherche des solutions.",
"Je sais √† qui je peux en parler si j‚Äôai un souci pour me d√©placer."
],
lifeSkills: {
"Personnalit√©": "autonomie",
"Valorisation": "fiabilit√© (√™tre √† l'heure)",
"Bien-√™tre": "anxi√©t√© trajets",
"Ressources": "permis / co√ªt / r√©seau"
}
},
{
name: "Sant√©",
icon: "‚ù§Ô∏è",
objective: "Voir comment tu te sens dans ton corps et dans ta t√™te, et comment tu g√®res les coups de fatigue ou de stress.",
questions: [
"La plupart du temps, j‚Äôai assez d‚Äô√©nergie pour faire ce que j‚Äôai √† faire.",
"Je remarque quand quelque chose ne va pas (fatigue, moral, douleurs‚Ä¶).",
"J‚Äôai quelques fa√ßons √† moi pour me calmer ou me d√©tendre quand √ßa ne va pas.",
"Il y a au moins une personne √† qui je peux dire quand √ßa ne va pas.",
"Ma sant√© (physique ou mentale) complique parfois les choses pour moi."
],
lifeSkills: {
"Personnalit√©": "limites personnelles",
"Valorisation": "se sentir digne de soin",
"Bien-√™tre": "c≈ìur du domaine",
"Ressources": "acc√®s aux soins"
}
},
{
name: "Logement",
icon: "üè°",
objective: "Comprendre comment ton lieu de vie joue sur ton repos, ta s√©curit√© et ton organisation.",
questions: [
"J‚Äôai un endroit o√π dormir qui me semble suffisamment s√ªr.",
"L√† o√π je vis, je peux me reposer un minimum quand j‚Äôen ai besoin.",
"Mon lieu de vie me permet globalement d‚Äôaller √† mes rendez-vous et activit√©s.",
"Si ma situation de logement devait changer, je saurais vers qui me tourner pour en parler."
],
lifeSkills: {
"Personnalit√©": "estime ‚Äì je m√©rite un lieu stable",
"Valorisation": "capacit√© √† demander un accompagnement",
"Bien-√™tre": "sommeil / s√©curit√©",
"Ressources": "logement / dispositifs"
}
},
{
name: "Citoyennet√©",
icon: "ü§ù",
objective: "Rep√©rer ta place dans les groupes, tes droits et ton envie de participer.",
questions: [
"Dans un petit groupe o√π je me sens en confiance, j‚Äôarrive √† dire ce que je pense.",
"Il y a au moins un adulte (pro ou proche) qui m‚Äô√©coute vraiment quand je parle.",
"Je sais que j‚Äôai des droits (m√™me si je ne les connais pas tous en d√©tail).",
"Si un projet, une action ou une cause m‚Äôint√©resse, je pourrais m‚Äôy investir.",
"Quand quelque chose ne me convient pas, je peux l‚Äôexprimer sans exploser ni tout fuir."
],
lifeSkills: {
"Personnalit√©": "sentiment d'agir",
"Valorisation": "place dans les groupes",
"Bien-√™tre": "environnement sain ou toxique",
"Ressources": "droits / participation"
}
},
{
name: "Finances",
icon: "üí∂",
objective: "Explorer ta relation √† l‚Äôargent, au budget et aux aides possibles.",
questions: [
"Je sais globalement d‚Äôo√π vient l‚Äôargent que je re√ßois et comment je le d√©pense.",
"Je remarque quand je risque d‚Äô√™tre juste niveau argent.",
"Je peux parler d‚Äôargent avec quelqu‚Äôun en qui j‚Äôai confiance.",
"Je sais qu‚Äôil existe des aides possibles (m√™me si je ne connais pas tous les d√©tails).",
"Le manque d‚Äôargent m‚Äôemp√™che parfois de faire des choses importantes pour moi."
],
lifeSkills: {
"Personnalit√©": "prise de d√©cision / priorisation",
"Valorisation": "sortir de la honte financi√®re",
"Bien-√™tre": "stress budget",
"Ressources": "aides / gestion"
}
},
{
name: "Loisirs",
icon: "üé®",
objective: "Rep√©rer ce qui te fait du bien et t‚Äôaide √† tenir dans le quotidien.",
questions: [
"J‚Äôai au moins une activit√© ou un centre d‚Äôint√©r√™t qui me fait du bien.",
"Je garde un peu de temps pour moi dans la semaine (m√™me si ce n‚Äôest pas beaucoup).",
"De temps en temps, j‚Äôessaie de nouvelles activit√©s, lieux ou fa√ßons de faire.",
"Ce que j‚Äôaime faire m‚Äôaide √† me sentir mieux ou plus confiant.",
"Je vois un peu le lien entre ce que j‚Äôaime et ce que je pourrais faire plus tard."
],
lifeSkills: {
"Personnalit√©": "go√ªts, talents",
"Valorisation": "parler de ses passions comme forces",
"Bien-√™tre": "r√©gulation √©motionnelle",
"Ressources": "acc√®s activit√©"
}
},
{
name: "Num√©rique",
icon: "üì±",
objective: "Voir comment tu utilises ton t√©l√©phone, internet et les d√©marches en ligne.",
questions: [
"J‚Äôai acc√®s √† un t√©l√©phone et √† internet assez r√©guli√®rement.",
"Je peux me d√©brouiller (avec ou sans aide) pour faire une d√©marche en ligne simple.",
"Je sais chercher des informations utiles sur internet (horaires, droits, services‚Ä¶).",
"Je fais attention √† ce que je publie sur les r√©seaux, selon avec qui je partage.",
"Si j‚Äôai une gal√®re num√©rique, je sais √† qui demander un coup de main."
],
lifeSkills: {
"Personnalit√©": "limites / choix / contr√¥le",
"Valorisation": "pr√©sence en ligne pro",
"Bien-√™tre": "gestion r√©seaux / pression sociale",
"Ressources": "acc√®s num√©rique / d√©marches"
}
},
{
name: "Mode de vie",
icon: "‚è≥",
objective: "Comprendre comment ton rythme de vie t‚Äôaide (ou pas) √† tenir dans la dur√©e.",
questions: [
"Mon sommeil me permet globalement de r√©cup√©rer (m√™me si ce n‚Äôest pas parfait).",
"Quand c‚Äôest important, j‚Äôarrive en g√©n√©ral √† √™tre √† l‚Äôheure.",
"Je note ou je garde des rappels pour ne pas oublier mes rendez-vous importants.",
"Je r√©ussis √† jongler plus ou moins entre mes activit√©s, obligations et temps pour moi.",
"Je remarque quand j‚Äôai besoin de souffler et j‚Äôessaie de me garder un moment pour √ßa."
],
lifeSkills: {
"Personnalit√©": "organisation personnelle / limites",
"Valorisation": "fiabilit√© / ponctualit√©",
"Bien-√™tre": "√©quilibre vie / r√©cup√©ration",
"Ressources": "gestion du temps / outils"
}
}
];

const lifeSkillsMapping = {
"Personnalit√©": ["Orientation", "Sant√©", "Mode de vie"],
"Valorisation": ["Emploi", "Formation", "Citoyennet√©"],
"Bien-√™tre": ["Sant√©", "Logement", "Loisirs"],
"Ressources": ["Mobilit√©", "Finances", "Num√©rique"]
};

// Activit√©s (inchang√© sur le fond)
const domainActivities = {
"Emploi": [
{
title: "Mon Pitch en 30 secondes",
objective: "Apprendre √† parler de soi simplement.",
skills: ["Valorisation", "Personnalit√©"],
duration: "45 min",
format: "Individuel + vid√©o",
steps: [
"Compl√©ter 3 phrases : ¬´ Je suis‚Ä¶ ¬ª, ¬´ On me reconna√Æt souvent pour‚Ä¶ ¬ª, ¬´ Je suis dou√©¬∑e pour‚Ä¶ ¬ª",
"Construire un pitch simple et authentique.",
"Enregistrer une vid√©o de pr√©sentation.",
"Recevoir des retours bienveillants du groupe."
],
transfer: "Utile pour les entretiens d'embauche et pr√©sentations professionnelles."
}
],
"Formation": [
{
title: "Le Feedback qui fait grandir",
objective: "Apprendre √† recevoir et demander un feedback.",
skills: ["Valorisation", "Bien-√™tre"],
duration: "1h",
format: "Collectif + bin√¥mes",
steps: [
"Mini-jeu : rep√©rer les ¬´ bons ¬ª et ¬´ mauvais ¬ª feedbacks.",
"Simulations en bin√¥me pour s'entra√Æner.",
"Formuler une action concr√®te ¬´ je progresse dans‚Ä¶ ¬ª.",
"Debrief collectif sur les apprentissages."
],
transfer: "Am√©liore la capacit√© d'apprentissage et l‚Äôadaptation en formation."
}
],
"Orientation": [
{
title: "Mon Mini Magazine de Vie (Zine)",
objective: "Faire √©merger centres d‚Äôint√©r√™t et valeurs.",
skills: ["Personnalit√©", "Valorisation"],
duration: "1h30",
format: "Atelier cr√©atif individuel",
steps: [
"Choisir des images/mots qui parlent de sa vie id√©ale.",
"Structurer en 4 pages : moi / mes forces / ce que j‚Äôaime / vers o√π j‚Äôai envie d‚Äôaller.",
"Finaliser son mini-magazine.",
"Option : pr√©senter une page au groupe."
],
transfer: "Clarifie le projet de vie et facilite les choix d‚Äôorientation."
}
],
"Mobilit√©": [
{
title: "Moi en d√©placement : choix & cons√©quences",
objective: "Comprendre l‚Äôimpact de la mobilit√© sur le projet.",
skills: ["Ressources", "Organisation"],
duration: "45 min",
format: "Simulation pratique",
steps: [
"Choisir un sc√©nario : aller au travail, en formation, √† un rendez-vous important.",
"Identifier au moins 2 solutions de transport possibles.",
"Estimer le temps et le co√ªt de chaque solution.",
"Rep√©rer les difficult√©s possibles et les solutions associ√©es.",
"Choisir une prochaine √©tape concr√®te pour sa mobilit√©."
],
transfer: "Facilite l‚Äôacc√®s √† l‚Äôemploi et √† la formation en anticipant les trajets."
}
],
"Sant√©": [
{
title: "Mon Stressom√®tre",
objective: "Rep√©rer ses signaux de stress et cr√©er un kit apaisement.",
skills: ["Bien-√™tre", "Personnalit√©"],
duration: "1h",
format: "Auto-√©valuation + mise en pratique",
steps: [
"Se situer sur un stressom√®tre simple (calme / sous pression / en alerte).",
"Identifier ses signaux (corporels, √©motions, pens√©es).",
"Lister ce qui aide d√©j√† √† se calmer.",
"Construire son ¬´ kit apaisement ¬ª (3 actions concr√®tes).",
"Tester une technique d‚Äôapaisement durant l‚Äôatelier."
],
transfer: "Aide √† g√©rer les entretiens, la formation et le quotidien."
}
],
"Logement": [
{
title: "Mon Budget Logement",
objective: "Visualiser le co√ªt d‚Äôun logement autonome.",
skills: ["Ressources"],
duration: "45 min",
format: "Calcul pratique",
steps: [
"Trouver un exemple de logement r√©aliste dans sa zone.",
"Lister toutes les charges associ√©es (loyer, √©nergie, internet, assurance‚Ä¶).",
"Comparer avec ses ressources actuelles ou futures.",
"Rep√©rer des pistes : colocation, aides, autre secteur g√©ographique.",
"Formuler une √©tape logement r√©aliste √† court terme."
],
transfer: "Pr√©pare l‚Äôautonomie et s√©curise les conditions de vie."
}
],
"Citoyennet√©": [
{
title: "Ma Carte de Soutien",
objective: "Identifier son r√©seau d‚Äôaide.",
skills: ["Valorisation", "Personnalit√©"],
duration: "1h",
format: "Cartographie + plan d‚Äôaction",
steps: [
"Dessiner les personnes / lieux ressources autour de soi.",
"Mettre en avant les personnes positives, les lieux ¬´ safe ¬ª.",
"Identifier les besoins d‚Äôaide actuels.",
"Rep√©rer les manques dans le r√©seau.",
"Choisir une personne √† contacter dans la semaine."
],
transfer: "Facilite l‚Äôacc√®s au soutien et aux opportunit√©s."
}
],
"Finances": [
{
title: "Du Brut au Net",
objective: "Comprendre le salaire et poser un budget simple.",
skills: ["Ressources"],
duration: "1h",
format: "Simulation + discussion",
steps: [
"Simuler un salaire net √† partir d‚Äôun brut.",
"Lister les d√©penses de base (logement, transports, alimentation‚Ä¶).",
"Calculer le reste √† vivre.",
"Discuter des priorit√©s et marges de man≈ìuvre.",
"Identifier une premi√®re action pour mieux suivre son argent."
],
transfer: "Pr√©pare l‚Äôautonomie financi√®re et la n√©gociation salariale."
}
],
"Loisirs": [
{
title: "Mes Boosters de Bien-√ätre",
objective: "Rep√©rer ce qui fait du bien au quotidien.",
skills: ["Bien-√™tre"],
duration: "30 min",
format: "R√©flexion + planification",
steps: [
"Lister les activit√©s, lieux et personnes qui font du bien.",
"Choisir 2‚Äì3 actions simples √† int√©grer dans la semaine.",
"V√©rifier la faisabilit√© (temps, co√ªt, transport).",
"Inscrire ces moments dans un planning ou agenda.",
"S‚Äôengager sur une premi√®re action dans les 48h."
],
transfer: "Aide √† garder l‚Äô√©nergie et la motivation dans le parcours."
}
],
"Num√©rique": [
{
title: "Mon Image en Ligne",
objective: "Faire le point sur son identit√© num√©rique.",
skills: ["Valorisation", "Ressources"],
duration: "1h",
format: "Audit + mise √† jour",
steps: [
"Chercher son pr√©nom/nom sur internet et regarder ce qui appara√Æt.",
"Faire le tour de ses principaux profils (photos, bio, publications).",
"Nettoyer ce qui ne correspond plus √† l‚Äôimage souhait√©e.",
"Cr√©er ou mettre √† jour un profil √† vis√©e pro simple.",
"D√©finir 2‚Äì3 r√®gles pour sa pr√©sence en ligne."
],
transfer: "S√©curise l‚Äôimage aupr√®s des employeurs et partenaires."
}
],
"Mode de vie": [
{
title: "Ma Routine Qui Me Fait du Bien",
objective: "Installer un rythme plus stable.",
skills: ["Personnalit√©", "Bien-√™tre"],
duration: "45 min",
format: "Analyse + construction",
steps: [
"Rep√©rer ses habitudes actuelles (sommeil, √©crans, repas, sorties‚Ä¶).",
"Choisir un petit changement prioritaire.",
"Construire une mini-routine r√©aliste.",
"Pr√©voir les obstacles possibles et comment les contourner.",
"Fixer un point de bilan avec le conseiller."
],
transfer: "Aide √† tenir dans la dur√©e les d√©marches d‚Äôinsertion."
}
]
};

let currentDomain = 0;
let responses = {};
let currentRecordCount = 0;
let allAssessments = [];

const defaultConfig = {
tool_title: "Diagnostic Life Skills",
organization_name: "Mission Locale Edition",
instructions_text:
"Ce diagnostic rep√®re les forces et les besoins d‚Äôun jeune dans 11 domaines de vie. Il sert de support au Rep√©rage / Premier Entretien."
};

const dataHandler = {
onDataChanged(data) {
allAssessments = data;
currentRecordCount = data.length;
displaySavedAssessments();
}
};

// --- INIT SDK / CONFIG ---

async function initializeApp() {
if (window.dataSdk) {
const initResult = await window.dataSdk.init(dataHandler);
if (!initResult.isOk) {
console.error("Erreur d'initialisation du SDK de donn√©es");
}
}

if (window.elementSdk) {
await window.elementSdk.init({
defaultConfig,
onConfigChange: async (config) => {
const toolTitle = config.tool_title || defaultConfig.tool_title;
const orgName =
config.organization_name || defaultConfig.organization_name;
const instructions =
config.instructions_text || defaultConfig.instructions_text;

document.getElementById("toolTitle").textContent = toolTitle;
document.getElementById("organizationName").textContent = orgName;
document.getElementById("instructionsText").textContent =
instructions;
},
mapToCapabilities: (config) => ({
recolorables: [
{
get: () => config.primary_color || "#f39200",
set: (value) => {
if (window.elementSdk) {
window.elementSdk.setConfig({ primary_color: value });
}
}
},
{
get: () => config.secondary_color || "#2897d5",
set: (value) => {
if (window.elementSdk) {
window.elementSdk.setConfig({ secondary_color: value });
}
}
}
],
borderables: [],
fontEditable: {
get: () => config.font_family || "system-ui",
set: (value) => {
if (window.elementSdk) {
window.elementSdk.setConfig({ font_family: value });
}
}
},
fontSizeable: {
get: () => config.font_size || 16,
set: (value) => {
if (window.elementSdk) {
window.elementSdk.setConfig({ font_size: value });
}
}
}
}),
mapToEditPanelValues: (config) =>
new Map([
["tool_title", config.tool_title || defaultConfig.tool_title],
[
"organization_name",
config.organization_name || defaultConfig.organization_name
],
[
"instructions_text",
config.instructions_text || defaultConfig.instructions_text
]
])
});
}
}

// --- RATING LABELS SIMPLIFI√âS ---

function getRatingLabel(value) {
const labels = {
1: "üôà Pas encore",
2: "üôÇ Un peu",
3: "üí™ Plut√¥t oui",
4: "üåü Tout √† fait"
};
return labels[value];
}

function updateRatingSelection(questionId, value) {
responses[questionId] = value;
// rafra√Æchit l‚Äô√©tat visuel
const radios = document.querySelectorAll(
`input[name="${questionId}"]`
);
radios.forEach((input) => {
const parent = input.closest(".rating-option");
if (!parent) return;
if (Number(input.value) === value && input.checked) {
parent.classList.add("selected");
} else {
parent.classList.remove("selected");
}
});
updateNavigationButtons();
}

// --- AFFICHAGE DIAGNOSTICS SAUVEGARD√âS (SDK) ---

function displaySavedAssessments() {
const container = document.getElementById("savedAssessments");
const list = document.getElementById("assessmentsList");

if (!allAssessments || allAssessments.length === 0) {
container.style.display = "none"
return;
}

container.style.display = "block"
list.innerHTML = ""

allAssessments.forEach((assessment) => {
const item = document.createElement("div");
item.className = "assessment-item"

const date = new Date(assessment.assessment_date);
const formattedDate = date.toLocaleDateString("fr-FR");

item.innerHTML = `
<div class="assessment-info">
<div class="assessment-name">${assessment.participant_name}</div>
<div class="assessment-date">Diagnostic du ${formattedDate}</div>
</div>
<button class="btn btn-small btn-secondary"
type="button"
onclick="viewAssessment('${assessment.__backendId}')">
Voir
</button>
`;
list.appendChild(item);
});
}

function viewAssessment(assessmentId) {
const assessment = allAssessments.find(
(a) => a.__backendId === assessmentId
);
if (!assessment) return;

responses = JSON.parse(assessment.domain_scores);
showResults();
showStep("step-results");
}

// --- LOCALSTORAGE ---

function saveLocalAssessment(payload) {
try {
localStorage.setItem("ls4you_diag_last", JSON.stringify(payload));
} catch (e) {
console.warn("Impossible de sauvegarder dans le navigateur", e);
}
}

function loadLocalAssessment() {
try {
const raw = localStorage.getItem("ls4you_diag_last");
if (!raw) {
showInlineMessage(
"Aucun diagnostic enregistr√© sur cet appareil.",
"warning"
);
return;
}
const data = JSON.parse(raw);
responses = data.responses || {};
document.getElementById("participantName").value =
data.participant_name || ""
showResults();
showStep("step-results");
showInlineMessage(
"Dernier diagnostic charg√© depuis cet appareil.",
"success"
);
} catch (e) {
showInlineMessage("Erreur lors du chargement local.", "error");
}
}

// --- FLUX DIAGNOSTIC ---

function startAssessment() {
const name = document
.getElementById("participantName")
.value.trim();
if (!name) {
showInlineMessage("Merci de renseigner le pr√©nom et le nom.", "warning");
return;
}
currentDomain = 0;
responses = {};
generateQuestions();
showStep("step-assessment");
updateProgress();
updateNavigationButtons();
}

function generateQuestions() {
const container = document.getElementById("questionsContainer");
container.innerHTML = ""

domains.forEach((domain, domainIndex) => {
const domainDiv = document.createElement("div");
domainDiv.className = "domain-section"
domainDiv.id = `domain-${domainIndex}`;
domainDiv.style.display = domainIndex === 0 ? "block" : "none"

domainDiv.innerHTML = `
<div class="domain-title">
<span class="domain-icon">${domain.icon}</span>
${domain.name}
</div>
<div class="domain-objective">
<strong>Objectif :</strong> ${domain.objective}
</div>
`;

domain.questions.forEach((question, questionIndex) => {
const questionDiv = document.createElement("div");
questionDiv.className = "question"
const questionId = `q_${domainIndex}_${questionIndex}`;

const optionsHtml = [1, 2, 3, 4]
.map(
(value) => `
<label class="rating-option" data-value="${value}">
<input
type="radio"
name="${questionId}"
value="${value}"
aria-label="${getRatingLabel(value)}"
onchange="updateRatingSelection('${questionId}', ${value})"
>
<span class="rating-label">${getRatingLabel(value)}</span>
</label>
`
)
.join("");

questionDiv.innerHTML = `
<div class="question-text">${question}</div>
<div class="rating-scale" role="radiogroup" aria-label="${question}">
${optionsHtml}
</div>
`;
domainDiv.appendChild(questionDiv);
});

container.appendChild(domainDiv);
});
}

function updateNavigationButtons() {
const prevBtn = document.getElementById("prevBtn");
const nextBtn = document.getElementById("nextBtn");

prevBtn.style.display = currentDomain > 0 ? "inline-flex" : "none"

if (currentDomain === domains.length - 1) {
const allAnswered = domains[currentDomain].questions.every(
(_, qIndex) =>
responses[`q_${currentDomain}_${qIndex}`] !== undefined
);
nextBtn.textContent = allAnswered
? "Voir mes r√©sultats"
: "Terminer"
nextBtn.disabled = !allAnswered;
} else {
nextBtn.textContent = "Suivant ‚ñ∂Ô∏è"
nextBtn.disabled = false;
}
}

function nextDomain() {
if (currentDomain < domains.length - 1) {
const allAnswered = domains[currentDomain].questions.every(
(_, qIndex) =>
responses[`q_${currentDomain}_${qIndex}`] !== undefined
);
if (!allAnswered) {
showInlineMessage(
"Merci de r√©pondre √† toutes les phrases du domaine avant de continuer.",
"warning"
);
return;
}
document.getElementById(
`domain-${currentDomain}`
).style.display = "none"
currentDomain++;
document.getElementById(
`domain-${currentDomain}`
).style.display = "block"
updateProgress();
updateNavigationButtons();
} else {
showResults();
showStep("step-results");
}
}

function previousDomain() {
if (currentDomain > 0) {
document.getElementById(
`domain-${currentDomain}`
).style.display = "none"
currentDomain--;
document.getElementById(
`domain-${currentDomain}`
).style.display = "block"
updateProgress();
updateNavigationButtons();
}
}

function updateProgress() {
const progress =
((currentDomain + 1) / domains.length) * 100;
document.getElementById(
"progressFill"
).style.width = `${progress}%`;
}

// --- CALCUL & AFFICHAGE R√âSULTATS ---

function showResults() {
const domainScores = {};
domains.forEach((domain, domainIndex) => {
const domainResponses = domain.questions.map(
(_, qIndex) =>
responses[`q_${domainIndex}_${qIndex}`] || 0
);
const average =
domainResponses.reduce((a, b) => a + b, 0) /
domainResponses.length;
domainScores[domain.name] = Math.round((average / 4) * 100);
});

const lifeSkillsScores = {};
Object.keys(lifeSkillsMapping).forEach((skill) => {
const relatedDomains = lifeSkillsMapping[skill];
const scores = relatedDomains.map(
(domainName) => domainScores[domainName]
);
const average =
scores.reduce((a, b) => a + b, 0) / scores.length;
lifeSkillsScores[skill] = Math.round(average);
});

displayLifeSkillsResults(lifeSkillsScores);
displayDomainResults(domainScores);
displayPriorityAreas(domainScores);
displayActionPlan(domainScores);
}

function displayLifeSkillsResults(scores) {
const container = document.getElementById("lifeSkillsResults");
container.innerHTML = ""
Object.entries(scores).forEach(([skill, score]) => {
const card = document.createElement("div");
card.className = "skill-card"
card.innerHTML = `
<div class="skill-name">${skill}</div>
<div class="skill-score">${score}%</div>
`;
container.appendChild(card);
});
}

function displayDomainResults(scores) {
const container = document.getElementById("domainResults");
container.innerHTML = ""
Object.entries(scores).forEach(([domain, score]) => {
const bar = document.createElement("div");
bar.className = "domain-bar"
bar.innerHTML = `
<div class="domain-bar-name">${domain}</div>
<div class="bar-container">
<div class="bar-fill" style="width: ${score}%">${score}%</div>
</div>
`;
container.appendChild(bar);
});
}

function displayPriorityAreas(scores) {
const lowScoreAreas = Object.entries(scores)
.filter(([, score]) => score < 60)
.sort((a, b) => a[1] - b[1])
.map(([domain, score]) => ({ domain, score }));

const container = document.getElementById("priorityAreas");

if (lowScoreAreas.length === 0) {
container.innerHTML = `
<div class="priority-title">üéâ Tout est plut√¥t bien √©quilibr√©</div>
<p>Tu n‚Äôas pas de gros signaux d‚Äôalerte sur un domaine en particulier.</p>
<p><strong>Avec ton conseiller :</strong> vous pouvez choisir ensemble 1 √† 2 domaines √† renforcer encore.</p>
`;
return;
}

container.innerHTML = `
<div class="priority-title">üéØ Choisir 1 √† 3 domaines prioritaires</div>
<p>Voici les domaines o√π tu pourrais concentrer tes efforts en premier :</p>
<div style="margin: 8px 0 4px;">
${lowScoreAreas
.map(
({ domain, score }) => `
<label>
<input type="checkbox" name="priority" value="${domain}"
onchange="updatePrioritySelection()">
<strong>${domain}</strong> ‚Äì ${score}%
</label>
`
)
.join("")}
</div>
<p><em>Tu peux cocher les domaines que tu souhaites travailler en priorit√© avec ton conseiller.</em></p>
<div id="selectedPriorities"></div>
`;
}

function updatePrioritySelection() {
const checkboxes = document.querySelectorAll(
'input[name="priority"]:checked'
);
let selected = Array.from(checkboxes).map((cb) => cb.value);
if (selected.length > 3) {
checkboxes[checkboxes.length - 1].checked = false;
selected = selected.slice(0, 3);
}
const display = document.getElementById("selectedPriorities");
if (selected.length > 0) {
display.textContent =
"‚úÖ Domaines choisis : " + selected.join(", ");
} else {
display.textContent = ""
}
}

function displayActionPlan(scores) {
const container = document.getElementById("actionPlan");
const recommendations = generateRecommendations(scores);
container.innerHTML = `
<div class="action-title">üìã Pistes d‚Äôaction √† discuter</div>
<div>${recommendations}</div>
`;
}

function generateRecommendations(scores) {
const lowScores = Object.entries(scores)
.filter(([, score]) => score < 60)
.sort((a, b) => a[1] - b[1]);

if (lowScores.length === 0) {
return `
<p><strong>Maintien & consolidation :</strong></p>
<ul>
<li>Garder les habitudes qui fonctionnent d√©j√† pour toi.</li>
<li>Partager tes bonnes pratiques avec d‚Äôautres jeunes (atelier, t√©moignage‚Ä¶).</li>
<li>Choisir, avec ton conseiller, 1 domaine √† booster encore plus.</li>
</ul>
`;
}

const recommendations = {
"Emploi":
"Travailler ton pitch, ton CV et t‚Äôentra√Æner √† des entretiens.",
"Formation":
"Explorer les formations possibles et voir les aides associ√©es.",
"Orientation":
"Faire un point sur tes envies, tes essais, et tester des pistes.",
"Mobilit√©":
"Trouver des solutions de transport r√©alistes pour tes projets.",
"Sant√©":
"Mettre en place des routines simples pour prendre soin de toi, et rep√©rer les pros ressources.",
"Logement":
"Voir avec les bons partenaires ce qui existe pour s√©curiser ta situation.",
"Citoyennet√©":
"Te connecter √† des lieux, des projets ou des collectifs o√π tu peux t‚Äôexprimer.",
"Finances":
"Mettre √† plat tes entr√©es/sorties d‚Äôargent et voir les aides mobilisables.",
"Loisirs":
"Prot√©ger quelques temps ¬´ ressources ¬ª dans ta semaine.",
"Num√©rique":
"S√©curiser ton image en ligne et renforcer les bases des d√©marches num√©riques.",
"Mode de vie":
"Ajuster un peu ton rythme (sommeil, organisation, √©crans) pour te sentir mieux."
};

return `
<p><strong>Id√©es √† explorer :</strong></p>
<ol>
${lowScores
.slice(0, 3)
.map(
([domain]) =>
`<li><strong>${domain}</strong> : ${
recommendations[domain] ||
"√Ä travailler avec ton conseiller."
}</li>`
)
.join("")}
</ol>
<p><em>Ces pistes sont √† adapter avec ton conseiller, en fonction de ta r√©alit√© et de ton rythme.</em></p>
`;
}

// --- SAUVEGARDE (SDK + LOCAL) ---

async function saveResults() {
const saveBtn = document.getElementById("saveBtn");
const loading = document.getElementById("loading");

if (currentRecordCount >= 999) {
showInlineMessage(
"Limite de 999 diagnostics atteinte. Merci de supprimer des anciens enregistrements.",
"error"
);
return;
}

try {
saveBtn.disabled = true;
loading.style.display = "block"

const participantName =
document.getElementById("participantName").value || "Sans nom"

const domainScores = {};
domains.forEach((domain, domainIndex) => {
const domainResponses = domain.questions.map(
(_, qIndex) =>
responses[`q_${domainIndex}_${qIndex}`] || 0
);
const average =
domainResponses.reduce((a, b) => a + b, 0) /
domainResponses.length;
domainScores[domain.name] = Math.round((average / 4) * 100);
});

const lifeSkillsScores = {};
Object.keys(lifeSkillsMapping).forEach((skill) => {
const relatedDomains = lifeSkillsMapping[skill];
const scores = relatedDomains.map(
(domainName) => domainScores[domainName]
);
const average =
scores.reduce((a, b) => a + b, 0) / scores.length;
lifeSkillsScores[skill] = Math.round(average);
});

const priorityAreas = Object.entries(domainScores)
.filter(([, score]) => score < 60)
.map(([domain]) => domain);

const assessmentData = {
participant_name: participantName,
assessment_date: new Date().toISOString(),
domain_scores: JSON.stringify(domainScores),
life_skills_scores: JSON.stringify(lifeSkillsScores),
priority_areas: JSON.stringify(priorityAreas),
action_plan: generateRecommendations(domainScores),
completed: true
};

// Sauvegarde SDK (Epoc / backend)
if (window.dataSdk) {
const result = await window.dataSdk.create(assessmentData);
if (!result.isOk) {
showInlineMessage(
"Erreur lors de la sauvegarde serveur. Les donn√©es locales sont conserv√©es.",
"error"
);
} else {
showInlineMessage("Diagnostic sauvegard√©.", "success");
}
} else {
showInlineMessage(
"Sauvegarde locale uniquement (pas de connexion au serveur).",
"warning"
);
}

// Sauvegarde locale
saveLocalAssessment({
participant_name: participantName,
responses,
domainScores,
lifeSkillsScores,
priorityAreas
});
} catch (e) {
showInlineMessage(
"Erreur lors de la sauvegarde. Merci de r√©essayer.",
"error"
);
} finally {
saveBtn.disabled = false;
loading.style.display = "none"
}
}

function restartAssessment() {
currentDomain = 0;
responses = {};
document.getElementById("participantName").value = ""
showStep("step-welcome");
}

// --- √âTAPES / NAV ---

function showStep(stepId) {
document
.querySelectorAll(".step")
.forEach((step) => step.classList.remove("active"));
document.getElementById(stepId).classList.add("active");
window.scrollTo({ top: 0, behavior: "smooth" });
}

function showInlineMessage(message, type) {
const msg = document.createElement("div");
msg.className = `inline-message ${
type === "error"
? "error"
: type === "warning"
? "warning"
: "success"
}`;
const icon =
type === "error"
? "‚ö†Ô∏è"
: type === "warning"
? "‚ÑπÔ∏è"
: "‚úÖ"
msg.innerHTML = `<span>${icon}</span><span>${message}</span>`;
document.body.appendChild(msg);
setTimeout(() => {
msg.remove();
}, 3800);
}

// --- ACTIVIT√âS ---

function showActivities() {
const domainScores = {};
domains.forEach((domain, domainIndex) => {
const domainResponses = domain.questions.map(
(_, qIndex) =>
responses[`q_${domainIndex}_${qIndex}`] || 0
);
const average =
domainResponses.reduce((a, b) => a + b, 0) /
domainResponses.length;
domainScores[domain.name] = Math.round((average / 4) * 100);
});

const priorityDomains = Object.entries(domainScores)
.filter(([, score]) => score < 60)
.sort((a, b) => a[1] - b[1])
.map(([domain]) => domain);

const domainsToShow =
priorityDomains.length > 0
? priorityDomains.slice(0, 3)
: Object.entries(domainScores)
.sort((a, b) => a[1] - b[1])
.slice(0, 3)
.map(([domain]) => domain);

displayActivities(domainsToShow, domainScores);
showStep("step-activities");
}

function displayActivities(priorityDomains, domainScores) {
const container = document.getElementById("activitiesContainer");
container.innerHTML = ""

if (priorityDomains.length === 0) {
container.innerHTML = `
<div class="activity-card">
<h3>üéâ Tu as d√©j√† une bonne base dans tous les domaines</h3>
<p>Avec ton conseiller, vous pouvez choisir 1 domaine √† renforcer pour aller encore plus loin.</p>
</div>
`;
return;
}

const intro = document.createElement("div");
intro.className = "activity-card"
intro.style.background = "#f3f8ff"
intro.innerHTML = `
<h3>üéØ Activit√©s propos√©es en priorit√©</h3>
<p>Ces activit√©s LS4YOU peuvent √™tre mobilis√©es en individuel ou en collectif sur les domaines suivants :</p>
<div style="display:flex;flex-wrap:wrap;gap:6px;margin-top:6px;">
${priorityDomains
.map(
(domain) => `
<span class="meta-item">${domain} ‚Äì ${domainScores[domain]}%</span>
`
)
.join("")}
</div>
`;
container.appendChild(intro);

priorityDomains.forEach((domainName) => {
const activities = domainActivities[domainName];
if (!activities) return;
const domainIcon =
domains.find((d) => d.name === domainName)?.icon || "üéØ"

activities.forEach((activity) => {
const card = document.createElement("div");
card.className = "activity-card"
card.innerHTML = `
<div class="activity-header">
<div class="activity-icon">${domainIcon}</div>
<div>
<h3 class="activity-title">${activity.title}</h3>
<p class="activity-subtitle">Domaine : ${domainName}</p>
</div>
</div>
<p><strong>Objectif :</strong> ${activity.objective}</p>
<div class="skills-tags">
${activity.skills
.map(
(s) =>
`<span class="skill-tag">Life Skill : ${s}</span>`
)
.join("")}
</div>
<div class="activity-meta">
<div class="meta-item">‚è±Ô∏è ${activity.duration}</div>
<div class="meta-item">üë• ${activity.format}</div>
</div>
<div class="activity-steps">
<h4>üìã D√©roul√© type :</h4>
<ul class="step-list">
${activity.steps
.map((st) => `<li class="step-item">${st}</li>`)
.join("")}
</ul>
</div>
<div class="transfer-note">
<div class="transfer-title">üîÑ Transfert Mission Locale</div>
<p>${activity.transfer}</p>
</div>
`;
container.appendChild(card);
});
});

const finalNote = document.createElement("div");
finalNote.className = "activity-card"
finalNote.style.background = "#f1fdf4"
finalNote.innerHTML = `
<h4>üí° √Ä utiliser avec le conseiller</h4>
<p>Ces activit√©s peuvent √™tre mobilis√©es :</p>
<ul style="padding-left:18px;font-size:0.9rem;margin:4px 0 6px;">
<li>en <strong>autonomie accompagn√©e</strong> (jeune + support papier/num√©rique) ;</li>
<li>en <strong>entretien individuel</strong> (RPE, suivi, bilan) ;</li>
<li>en <strong>atelier collectif</strong> Life Skills / projet / mobilisation.</li>
</ul>
<p>Le diagnostic permet de choisir ensemble quelles activit√©s sont les plus pertinentes maintenant.</p>
`;
container.appendChild(finalNote);
}

// --- EXPORT PDF (via impression navigateur) ---

function exportToPDF() {
window.print();
}

// --- INIT ---

document.addEventListener("DOMContentLoaded", initializeApp);
</script>
</body>
</html>

